<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Twilio Trial Dialer</title>
  <script src="https://unpkg.com/@twilio/voice-sdk@latest/dist/twilio.min.js"></script>
</head>
<body>
  <h2>Trial Dialer</h2>
  <input type="text" id="phoneNumber" placeholder="Aranacak Verified numara" />
  <button id="callBtn">Ara</button>
  <button id="hangupBtn">Bitir</button>

  <script>
    let device;

    // Mikrofon izni sor
    navigator.mediaDevices.getUserMedia({ audio: true })
      .then(stream => stream.getTracks().forEach(track => track.stop()))
      .catch(err => alert("Lütfen mikrofon izni verin!"));

    async function getToken() {
      try {
        const res = await fetch("https://gettoken-1651.twil.io/path_1");
        const data = await res.json();
        return data.token;
      } catch(err) {
        console.error(err);
        alert("Token alınamadı!");
      }
    }

    document.getElementById('callBtn').onclick = async () => {
      const number = document.getElementById('phoneNumber').value.trim();
      if (!number) { alert("Numara girin!"); return; }
      console.log("Aranacak numara:", number);

      if (!device) {
        const token = await getToken();
        if (!token) return;

        device = new Twilio.Device(token, { codecPreferences:["opus","pcmu"] });

        device.on('ready', () => console.log("Device hazır"));
        device.on('error', err => console.error(err));
        device.on('connect', () => console.log("Arama başladı"));
        device.on('disconnect', () => console.log("Arama sona erdi"));
      }

      // Aramayı başlat
      device.connect({ To: number });
    };

    document.getElementById('hangupBtn').onclick = () => {
      if(device) device.disconnectAll();
    };
  </script>
</body>
</html>
